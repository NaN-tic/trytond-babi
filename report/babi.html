{% extends 'html_report/report/base.html' %}

{% block custom_style %}
<style type="text/css">
  @page {
    size: landscape;
    @top-left {
      content: "{{ company.rec_name }}. {{ company.party.vat_code }}";
    }
    @top-right {
      content: "{{ data['report_options']['now']|dateformat }}";
    }
    @bottom-right {
      content: counter(page) " / " counter(pages);
    }
  }
  hr {
    border-top: 1px solid #000;
  }
  .h3 {
    font-size: 14px;
  }
  body {
    font-family: 'Arial';
    font-size: 9px;
  }
  .page-break {
    padding-top: 10px;
    page-break-before: always;
  }
  .top20 {
    padding-top: 20px;
  }
  thead > tr > th {
    border-bottom: solid 1px #000 !important;
  }
  tbody tr {
    page-break-inside: avoid;
  }
  table.no-border td {
    border: 0px;
  }
  .border-cell-active {
    border-top: solid 1px #999 !important;
  }
  .border-cell {
    border-top: 0px !important;
  }
  #footer {
    position: fixed;
    bottom: 0;
  }
</style>
{% endblock %}

{% block title %}
  {{ data['report_name'] }}
{% endblock %}

{% macro draw_table(record, before) %}
  {% set current = [] %}
  {% set total_columns = data['headers']|length %}
  {% set cell_level = data['report_options']['cell_level'] %}
  <tr>
    {% for header in data['headers'] %}
      {% set internal_name = header['internal_name'] %}
      {% set val = record['record'][internal_name] %}
      {% set decimal_digits = header['decimal_digits'] %}
      {% set val_render = val|render_field(decimal_digits) %}
      {% set type = header['type'] %}
      {% set group_by = header['group_by'] %}
      {% set text_align = header['text-align'] %}
      {% do current.append(val_render) %}
      <td class="border-cell{% if current|length > cell_level or not val_render in before or total_columns == current|length or val_render == None or type == 'measure' %}-active{% endif %}
      text-{{ text_align }}">{% if type == 'measure' or not group_by or not val_render in before or total_columns == current|length %}{{ val_render or '' }}{% endif %}
    </td>{% endfor %}
  </tr>
    {% if record['childs'] %}
      {% for child in record['childs'] %}
          {{ draw_table(child, current) }}
      {% endfor %}
    {% endif %}
{% endmacro %}

{% block main %}
    <div class="container-fluid">

      <div class="row">
        <div class="col-md-12">
          <h2>{{ data['report_name'] }}</h2>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <table class="table no-border bottom2px top2px">
            <thead>
              {% for header in data['headers'] %}
                {% set key = header['internal_name'] %}
                {% set title = header['name'] %}
                {% set width = header['width'] %}
                {% set text_align = header['text-align'] %}
              <th id="{{ key }}" {% if width %}style="width: {{ width }}%"{% endif %} class="text-{{ text_align }}" nowrap>{{ title }}</th>
              {% endfor %}
            </thead>
            <tbody>
              {% for record in data['records'] %}
                  {{ draw_table(record, []) }}
              {% endfor %}
          </table>

        </div>
      </div>

    </div>
{% endblock %}
